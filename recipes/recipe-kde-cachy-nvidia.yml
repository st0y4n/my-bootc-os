---
# yaml-language-server: $schema=https://schema.blue-build.org/recipe-v1.json

name: kinoite-cachy-nvidia
base-image: ghcr.io/blue-build/base-images/fedora-kinoite-nvidia
image-version: latest
description: kde cachy nvidia

modules:
  - from-file: recipe.yml

  - type: custom-kernel
    source: local
    kernel: cachyos
    secrets:
      - type: file
        source: .secure_files/MOK.priv
        mount:
          type: file
          destination: /tmp/certs/MOK.priv
    sign:
      key: /tmp/certs/MOK.priv
      cert: /usr/share/cert/MOK.pem
      mok-password: stoyan
      

  - type: dnf
    repos:
      cleanup: true
      copr:
      - bieszczaders/kernel-cachyos-addons
    install:
      packages:
        - cachyos-settings
        - scx-scheds
        - scx-tools
        - kvantum
    remove:
      auto-remove: true
      packages:
        - zram-generator-defaults

  - type: script
    scripts:
      - adios-ioscheduler.sh

  - type: files
    files:
      - source: system-cachy
        destination: /

  - from-file: finalize.yml
