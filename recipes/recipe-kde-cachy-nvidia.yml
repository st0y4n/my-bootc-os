---
# yaml-language-server: $schema=https://schema.blue-build.org/recipe-v1.json

name: kinoite-cachy-nvidia
base-image: ghcr.io/ublue-os/kinoite-main
image-version: latest
description: kde cachy nvidia

modules:
  - from-file: recipe.yml

  - type: files
    files:
      - source: system-cachy
        destination: /

  - type: dnf
    repos:
      cleanup: true
      copr:
      - bieszczaders/kernel-cachyos-addons
    install:
      packages:
        - cachyos-settings
        - scx-scheds
        - scx-tools
        - kvantum
        - sbsign
    remove:
      auto-remove: true
      packages:
        - zram-generator-defaults

  - type: custom-kernel
    source: local
    kernel: cachyos
    nvidia: true
    secrets:
      - type: file
        source: .secure_files/MOK.priv
        mount:
          type: file
          destination: /tmp/certs/MOK.priv
    sign:
      key: /tmp/certs/MOK.priv
      cert: /usr/share/cert/MOK.pem
      mok-password: stoyan
    

  - type: script
    scripts:
      - adios-ioscheduler.sh

  - from-file: finalize.yml
